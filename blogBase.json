{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "Blog Title", "subTitle": "Blog description", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P3": {"htmlDir": "docs/post/DeepSeek -duo-mo-tai-da-mo-xing- Janus-Pro -ben-di-bu-shu-jiao-cheng.html", "labels": ["documentation"], "postTitle": "DeepSeek \u591a\u6a21\u6001\u5927\u6a21\u578b Janus-Pro \u672c\u5730\u90e8\u7f72\u6559\u7a0b", "postUrl": "post/DeepSeek%20-duo-mo-tai-da-mo-xing-%20Janus-Pro%20-ben-di-bu-shu-jiao-cheng.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/3", "commentNum": 0, "wordCount": 1071, "description": "# DeepSeek \u591a\u6a21\u6001\u5927\u6a21\u578b Janus-Pro \u672c\u5730\u90e8\u7f72\u6559\u7a0b\n\n## \u4e0b\u8f7d\u6a21\u578b\u4ed3\u5e93\n\n git clone https://github.com/deepseek-ai/Janus.git\u4e0b\u8f7d\u6a21\u578b\u4ed3\u5e93\n \n\u56fd\u5185\u4e0b\u8f7d\u4ed3\u5e93\u5931\u8d25\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7406\uff1a\n\ngit clone https://github.moeyy.xyz/https://github.com/deepseek-ai/Janus.git\n\u51c6\u5907 Conda 3.12 \u865a\u62df\u73af\u5883\nconda create --name deepseek7B python=3.12\n\nconda activate deepseek7B\nJanus \u5b89\u88c5\u57fa\u7840\u4f9d\u8d56\ncd Janus\n\n## \u5b89\u88c5\u57fa\u7840\u4f9d\u8d56\npip install -e .\n\n## \u5b89\u88c5 gradio ui \u754c\u9762\npip install gradio\n\n## \u542f\u52a8\u5e26\u6709gradio\u7684ui\u754c\u9762\uff0c\u540c\u65f6\u4e0b\u8f7d14GB+\u7684\u5927\u6a21\u578b\npython demo/app_januspro.py\n\u542f\u52a8\u6210\u529f\u540e,\u5728\u6d4f\u89c8\u5668\u91cc\u8f93\u5165\uff1ahttp://127.0.0.1:7860\uff0c\u5373\u53ef\u8bbf\u95ee Gradio \u9875\u9762\u3002", "top": 0, "createdAt": 1763477131, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-18", "dateLabelColor": "#0969da"}, "P4": {"htmlDir": "docs/post/Boost-zi-fu-chuan-cao-zuo.html", "labels": ["documentation"], "postTitle": "Boost\u5b57\u7b26\u4e32\u64cd\u4f5c", "postUrl": "post/Boost-zi-fu-chuan-cao-zuo.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/4", "commentNum": 1, "wordCount": 1403, "description": "```c++\n\n\n    #include <boost/algorithm/string.hpp>\n    #include <boost/regex.hpp>\n    #include <boost/filesystem.hpp>\n\n    std::string str = 'one,two,three,four'; \n    std::vector<std::string> result;\n    boost::split(result, str, boost::is_any_of(','));\n\n    for (const auto& s : result) {\n        std::cout << s << std::endl;\n    }\n    std::string str2 = 'Hello World,Hello World';\n    boost::algorithm::replace_all(str2,'World','Boost');\n    std::cout << str2 << std::endl; // \u8f93\u51fa: Hello Boost,Hello Boost\n\n    std::string str3 = '   Hello Boost   ';\n    boost::trim(str3);\n    std::cout << str3 << std::endl; //\u8f93\u51fa\uff1aHello Boost\n    \n    std::string str4 = 'Hello World,Hello World';\n    boost::replace_first(str4,'World','Boost');\n    std::cout << str4 << std::endl; // \u8f93\u51fa: Hello Boost,Hello World\n\n    std::string str5 = 'Hello World,Hello World';\n    boost::replace_last(str5,'World','Boost');\n    std::cout << str5 << std::endl; // \u8f93\u51fa: Hello World,Hello Boost\n\n    std::string str6 = '2024-05-20 13:45:30';\n    boost::regex date_regex('-');\n    std::string result2 = boost::regex_replace(str6, date_regex, '/');\n    std::cout << result2 << std::endl; // \u8f93\u51fa: 2024/05/20 13:45:30\n\n    std::string str7 = 'Apple banana apple orange APPLE,Apple,Apple,Apple';\n    boost::replace_nth(str7,'Apple',3,'Banana');\n    std::cout << str7 << std::endl; //\u8f93\u51fa Apple banana apple orange APPLE,Apple,Apple,Banana\n```\u3002", "top": 0, "createdAt": 1763477234, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-18", "dateLabelColor": "#0969da"}, "P5": {"htmlDir": "docs/post/vscode-pei-zhi-Boost-ku.html", "labels": ["documentation"], "postTitle": "vscode\u914d\u7f6eBoost\u5e93", "postUrl": "post/vscode-pei-zhi-Boost-ku.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/5", "commentNum": 0, "wordCount": 957, "description": "```\ncmake_minimum_required(VERSION 3.16.3)\n  project(testBoost VERSION 0.1.0)\n  \n  # \u8bbe\u7f6eC++\u6807\u51c6\n  set(CMAKE_CXX_STANDARD 11)\n  set(CMAKE_CXX_STANDARD_REQUIRED ON)\n  \n  # \u67e5\u627eBoost\u5e93\uff08\u4e0d\u9700\u8981\u7279\u5b9a\u7ec4\u4ef6\uff09\n  #find_package(Boost REQUIRED)\n  #if(Boost_FOUND)\n  #    message('Boost found: ${Boost_VERSION}')\n  #   include_directories(${Boost_INCLUDE_DIRS})\n  #else()\n  #    message(FATAL_ERROR 'Boost not found!')\n  #endif()\n  #\u9700\u8981thread\u548cfilessystem\u7ec4\u4ef6\n  find_package(Boost REQUIRED COMPONENTS thread filesystem)\n  if(Boost_FOUND)\n      message('Boost found: ${Boost_VERSION}')\n      include_directories(${Boost_INCLUDE_DIRS})\n  else()\n      message(FATAL_ERROR 'Boost not found!')\n  endif()\n  \n  # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\n  add_executable(testBoost version.cpp)\n  #\u5bf9\u4e8e\u4ec5\u6807\u5934\u5e93\uff0c\u60a8\u65e0\u9700\u94fe\u63a5\u5230\u5df2\u7f16\u8bd1\u7684 Boost \u5e93\u3002", "top": 0, "createdAt": 1763477347, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-18", "dateLabelColor": "#0969da"}, "P6": {"htmlDir": "docs/post/c++ condition_variable -feng-zhuang.html", "labels": ["documentation"], "postTitle": "c++ condition_variable \u5c01\u88c5", "postUrl": "post/c%2B%2B%20condition_variable%20-feng-zhuang.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/6", "commentNum": 0, "wordCount": 909, "description": "### \u5c01\u88c5\u7c7b\n```\n\n#include <condition_variable>\n#include <mutex>\n\n  // semaphore for queue/deque data structures in VideoPipe, used for producer-consumer pattern.\n  // it blocks the consumer thread until data has come.\n  class vp_semaphore\n  {\n  public:\n      vp_semaphore() {\n          count_ = 0;\n      }\n\n      void signal() {\n          std::unique_lock<std::mutex> lock(mutex_);\n          ++count_;\n          cv_.notify_one();\n      }\n\n      void wait() {\n          std::unique_lock<std::mutex> lock(mutex_);\n          cv_.wait(lock, [=] { return count_ > 0; });\n          --count_;\n      }\n\n  private:\n      std::mutex mutex_;\n      std::condition_variable cv_;\n      int count_;\n  };\n\n```\n### \u8c03\u7528\u65b9\u6cd5\n**\u5176\u4ed6\u7c7b\u4e2d\u58f0\u660e** \uff1avp_semaphore in_queue_semaphore;\n\n> \u5176\u4ed6\u7c7b\u7684\u65b9\u6cd5\u4f7f\u7528\n\u751f\u4ea7\u8005\n// notify consumer of in_queue\nin_queue_semaphore.signal();\n\u6d88\u8d39\u8005\n// wait for producer, make sure in_queue is not empty.\nin_queue_semaphore.wait();\n\n\n\n\u3002", "top": 0, "createdAt": 1763522754, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-19", "dateLabelColor": "#0969da"}, "P7": {"htmlDir": "docs/post/feng-zhuang-async_proc -yi-bu-ren-wu-chu-li.html", "labels": ["documentation"], "postTitle": "\u5c01\u88c5async_proc \u5f02\u6b65\u4efb\u52a1\u5904\u7406", "postUrl": "post/feng-zhuang-async_proc%20-yi-bu-ren-wu-chu-li.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/7", "commentNum": 0, "wordCount": 4056, "description": "###\u5c01\u88c5\u4ee3\u7801\n```\n#include <iostream>\n#include <thread>\n#include <mutex>\n#include <condition_variable>\n#include <queue>\n#include <functional>\n#include <atomic>\n\n// 1. \u5b9a\u4e49\u4f60\u7684\u4fe1\u53f7\u91cf\u7c7b\uff08\u4e0d\u53d8\uff09\nclass vp_semaphore {\npublic:\n    vp_semaphore() : count_(0) {}\n    void signal() {\n        std::unique_lock<std::mutex> lock(mutex_);\n        ++count_;\n        cv_.notify_one();\n    }\n    void wait() {\n        std::unique_lock<std::mutex> lock(mutex_);\n        cv_.wait(lock, [=] { return count_ > 0; });\n        --count_;\n    }\nprivate:\n    std::mutex mutex_;\n    std::condition_variable cv_;\n    int count_;\n};\n\n\nclass async_proc {\npublic:\n    using Task = std::function<void()>;\n    async_proc()\n    {\n        tid = std::thread([this]() {\n            while (live) {\n                semaphore_cv.wait();\n                if (!live)\n                    break;\n                // std::lock_guard<std::mutex> lock(task_mtx); \u53ef\u4ee5\u4e0d\u52a0 semaphore_cv\u4e2d\u5df2\u7ecf\u6709\u5bf9 task_que\u6570\u91cf\u7684\u5224\u65ad\n                if (task_que.empty()) {\n                    continue;\n                }\n                auto tsk = task_que.front();\n                task_que.pop();\n                tsk();\n            }\n        });\n    }\n    ~async_proc()\n    {\n        live = false;\n        semaphore_cv.signal();\n        tid.join();\n    }\n\n    template <typename F, typename... Args> void post_task(F &&f, Args &&...args)\n    {\n        Task tsk = std::bind(std::forward<F>(f), std::forward<Args>(args)...);\n        std::lock_guard<std::mutex> lock(task_mtx);\n        task_que.push(tsk);\n        semaphore_cv.signal();\n    }\n\n    async_proc(const async_proc &) = delete;\n    async_proc &operator=(const async_proc &) = delete;\n\nprivate:\n    std::queue<Task> task_que;\n    std::mutex task_mtx;\n    //\u58f0\u660e\u4e3a\u539f\u5b50\u53d8\u91cf\uff0c\u786e\u4fdd\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u5b89\u5168\u8bbf\u95ee\n    std::atomic<bool> live{true};\n    std::thread tid;\n    vp_semaphore semaphore_cv;\n};\n```\n\n###\u4f7f\u7528\u793a\u4f8b\n```\n// \u7b80\u5355\u7684\u51fd\u6570\u793a\u4f8b\nvoid print_hello() {\n    std::cout << 'Hello from thread! Thread ID: ' << std::this_thread::get_id() << std::endl;\n}\n\n// \u5e26\u53c2\u6570\u7684\u51fd\u6570\u793a\u4f8b\nvoid print_message(const std::string& message, int number) {\n    std::cout << 'Message: ' << message << ', Number: ' << number \n              << ' (Thread ID: ' << std::this_thread::get_id() << ')' << std::endl;\n}\n\n// \u5e26\u8fd4\u56de\u503c\u7684\u51fd\u6570\u793a\u4f8b\uff08\u5728\u5f02\u6b65\u73af\u5883\u4e2d\u8fd4\u56de\u503c\u4f1a\u88ab\u5ffd\u7565\uff0c\u9664\u975e\u901a\u8fc7\u5f15\u7528\u6216\u6307\u9488\u4f20\u9012\uff09\nvoid calculate_and_store(int a, int b, int& result) {\n    std::this_thread::sleep_for(std::chrono::milliseconds(100)); // \u6a21\u62df\u8017\u65f6\u64cd\u4f5c\n    result = a + b;\n    std::cout << 'Calculated: ' << a << ' + ' << b << ' = ' << result << std::endl;\n}\n\nint main() {\n    std::cout << 'Main thread ID: ' << std::this_thread::get_id() << std::endl;\n    \n    // \u521b\u5efa\u5f02\u6b65\u5904\u7406\u5668\u5b9e\u4f8b\n    async_proc processor;\n    \n    // \u793a\u4f8b1\uff1a\u63d0\u4ea4\u65e0\u53c2\u51fd\u6570\n    std::cout << 'Submitting print_hello task...' << std::endl;\n    processor.post_task(print_hello);\n    \n    // \u793a\u4f8b2\uff1a\u63d0\u4ea4\u5e26\u53c2\u6570\u7684\u51fd\u6570\n    std::cout << 'Submitting print_message task...' << std::endl;\n    processor.post_task(print_message, 'Async task', 42);\n    \n    // \u793a\u4f8b3\uff1a\u63d0\u4ea4Lambda\u8868\u8fbe\u5f0f\n    std::cout << 'Submitting lambda task...' << std::endl;\n    processor.post_task([]() {\n        std::cout << 'Lambda executed! ' \n                  << 'Current time: ' << std::chrono::system_clock::to_time_t(std::chrono::system_clock::now()) << std::endl;\n    });\n    \n    // \u793a\u4f8b4\uff1a\u63d0\u4ea4\u5e26\u72b6\u6001\u7684\u4efb\u52a1\uff08\u4f7f\u7528\u5f15\u7528\u4f20\u9012\u7ed3\u679c\uff09\n    int result = 0;\n    std::cout << 'Submitting calculation task...' << std::endl;\n    processor.post_task(calculate_and_store, 10, 32, std::ref(result));\n    \n    // \u793a\u4f8b5\uff1a\u63d0\u4ea4\u591a\u4e2a\u4efb\u52a1\uff0c\u5c55\u793a\u5e76\u53d1\u6267\u884c\n    std::cout << 'Submitting multiple tasks...' << std::endl;\n    for (int i = 0; i < 5; ++i) {\n        processor.post_task([i]() {\n            std::cout << 'Batch task ' << i << ' executing...' << std::endl;\n            std::this_thread::sleep_for(std::chrono::milliseconds(50)); // \u6a21\u62df\u4e0d\u540c\u7684\u6267\u884c\u65f6\u95f4\n            std::cout << 'Batch task ' << i << ' completed.' << std::endl;\n        });\n    }\n    \n    // \u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210\n    std::this_thread::sleep_for(std::chrono::seconds(1));\n    \n    // \u663e\u793a\u901a\u8fc7\u5f15\u7528\u83b7\u53d6\u7684\u8ba1\u7b97\u7ed3\u679c\n    std::cout << 'Final result from calculation: ' << result << std::endl;\n    \n    std::cout << 'Main function completed.' << std::endl;\n    return 0;\n}\n```\u3002", "top": 0, "createdAt": 1763540474, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-19", "dateLabelColor": "#0969da"}, "P8": {"htmlDir": "docs/post/Boost Http-fu-wu-duan---tong-bu-fang-shi.html", "labels": ["documentation", "Boost"], "postTitle": "Boost Http\u670d\u52a1\u7aef-\u540c\u6b65\u65b9\u5f0f", "postUrl": "post/Boost%20Http-fu-wu-duan---tong-bu-fang-shi.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/8", "commentNum": 0, "wordCount": 6362, "description": "```\n#include <boost/asio.hpp>\n#include <boost/beast.hpp>\n#include <boost/json.hpp>\n#include <iostream>\n#include <functional>\n#include <map>\n#include <string>\n#include <thread>\n#include <boost/thread.hpp>\nnamespace asio = boost::asio;\nnamespace beast = boost::beast;\nnamespace http = beast::http;\nnamespace json = boost::json;\nusing tcp = asio::ip::tcp;\n\n\n// \u5168\u5c40\u6807\u5fd7\uff0c\u7528\u4e8e\u63a7\u5236\u670d\u52a1\u5668\u9000\u51fa\nvolatile std::sig_atomic_t g_running = true;\n\n// \u4fe1\u53f7\u5904\u7406\u51fd\u6570\nvoid signalHandler(int signal) {\n    std::cout << 'Received signal ' << signal << ', shutting down...' << std::endl;\n    g_running = false;\n}\n\n// \u5b9a\u4e49\u5904\u7406\u5668\u51fd\u6570\u7c7b\u578b\ntypedef std::function<void(const http::request<http::string_body>&, http::response<http::string_body>&)> RequestHandler;\n\n\n// \u8def\u7531\u7ba1\u7406\u5668\u7c7b\uff0c\u7528\u4e8e\u6ce8\u518c\u548c\u67e5\u627e\u8def\u7531\nclass Router {\nprivate:\n    // \u8def\u7531\u8868\uff0c\u952e\u4e3aHTTP\u65b9\u6cd5+\u8def\u5f84\uff0c\u503c\u4e3a\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570\n    std::map<std::string, RequestHandler> routes;\n    \n    // \u751f\u6210\u8def\u7531\u952e\n    std::string getRouteKey(http::verb method, const std::string& target) {\n        return std::to_string(static_cast<int>(method)) + ':' + target;\n    }\n    \npublic:\n    // \u6ce8\u518c\u8def\u7531\n    void registerRoute(http::verb method, const std::string& target, RequestHandler handler) {\n        std::string key = getRouteKey(method, target);\n        routes[key] = handler;\n    }\n    \n    // \u67e5\u627e\u5e76\u6267\u884c\u8def\u7531\u5904\u7406\u51fd\u6570\n    bool handleRequest(const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        std::string key = getRouteKey(req.method(), std::string(req.target()));\n        \n        auto it = routes.find(key);\n        if (it != routes.end()) {\n            // \u627e\u5230\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570\uff0c\u6267\u884c\u5b83\n            it->second(req, res);\n            return true;\n        }\n        \n        return false; // \u672a\u627e\u5230\u5339\u914d\u7684\u8def\u7531\n    }\n};\n\n// \u5168\u5c40\u8def\u7531\u7ba1\u7406\u5668\u5b9e\u4f8b\nRouter g_router;\n\n// \u521d\u59cb\u5316\u8def\u7531\u8868\nvoid initializeRoutes() {\n    // \u6ce8\u518cGET /status\u8def\u7531\n    g_router.registerRoute(http::verb::get, '/status', [](const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        json::object response_json;\n        response_json['status'] = 'Server is running!';\n        \n        // \u8bbe\u7f6e\u54cd\u5e94\n        res.result(http::status::ok);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    });\n    \n    // \u6ce8\u518cPOST /greet\u8def\u7531\n    g_router.registerRoute(http::verb::post, '/greet', [](const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        json::object response_json;\n        \n        try {\n            // \u89e3\u6790\u8bf7\u6c42\u4f53\n            json::value parsed_body = json::parse(req.body());\n            \n            // \u63d0\u53d6name\u5b57\u6bb5\n            std::string name = parsed_body.as_object()['name'].as_string().c_str();\n            \n            // \u6784\u9020\u95ee\u5019\u6d88\u606f\n            response_json['message'] = 'Hello, ' + name + '!';\n        } catch (...) {\n            // \u9519\u8bef\u5904\u7406\n            response_json['error'] = 'Invalid JSON format.';\n        }\n        \n        // \u8bbe\u7f6e\u54cd\u5e94\n        res.result(http::status::ok);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    });\n    \n    // \u53ef\u4ee5\u6839\u636e\u9700\u8981\u7ee7\u7eed\u6dfb\u52a0\u66f4\u591a\u8def\u7531...\n}\n\n\n// Function to handle incoming HTTP requests and produce appropriate responses\nvoid handle_request(\n    http::request<http::string_body> req,         // Incoming HTTP request\n    http::response<http::string_body>& res        // Outgoing HTTP response (to be filled in)\n) {\n    // JSON object to hold the response body\n    json::object response_json;\n\n    // Log request information to the console for debugging\n    std::cout << 'Method: ' << req.method() << '...\\n';\n    std::cout << 'Target: ' << req.target() << '...\\n';\n    std::cout << 'Body: ' << req.body() << '...\\n\\n';\n\n    // \u5c1d\u8bd5\u5904\u7406\u8bf7\u6c42\n    if (!g_router.handleRequest(req, res)) {\n        // \u5982\u679c\u8def\u7531\u7ba1\u7406\u5668\u672a\u5904\u7406\u8bf7\u6c42\uff0c\u8fd4\u56de404 Not Found\n        response_json['error'] = 'Unknown endpoint.';\n        res.result(http::status::not_found);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    }\n}\n\n\n// \u5904\u7406\u5355\u4e2a\u8fde\u63a5\u7684\u51fd\u6570\nvoid handle_connection(tcp::socket socket) {\n    try {\n        beast::flat_buffer buffer;\n        http::request<http::string_body> req;\n        http::read(socket, buffer, req);\n\n        http::response<http::string_body> res;\n        handle_request(req, res);\n\n        http::write(socket, res);\n    } catch (std::exception& e) {\n        std::cerr << 'Connection error: ' << e.what() << '\\n';\n    }\n}\n\n// HTTP Server function\nvoid run_server(asio::io_context& ioc, unsigned short port, unsigned int thread_pool_size) {\n     // \u521b\u5efa\u7ebf\u7a0b\u6c60\n    asio::thread_pool pool(thread_pool_size);\n\n    tcp::acceptor acceptor(ioc, tcp::endpoint(tcp::v4(), port));\n\n    std::cout << 'HTTP Server running on port ' << port << '...\\n\\n';\n\n    while (true) {\n        tcp::socket socket(ioc);\n        acceptor.accept(socket);\n\n        // \u5c06\u8fde\u63a5\u5904\u7406\u4efb\u52a1\u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\n        asio::post(pool, [socket = std::move(socket)]() mutable {\n            handle_connection(std::move(socket));\n        });\n\n        // beast::flat_buffer buffer;\n        // http::request<http::string_body> req;\n        // http::read(socket, buffer, req);\n\n        // http::response<http::string_body> res;\n        // handle_request(req, res);\n\n        // http::write(socket, res);\n    }\n    std::cout << 'Server shutting down, waiting for active connections...\\n';\n    // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u6c60\u4efb\u52a1\u5b8c\u6210\n    // \u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u6c60\u4efb\u52a1\u5b8c\u6210\n    pool.join();\n    std::cout << 'Server shutdown complete\\n';\n}\n\nint main() {\n    try {\n\n        // \u6ce8\u518c\u4fe1\u53f7\u5904\u7406\n        std::signal(SIGINT, signalHandler);\n        std::signal(SIGTERM, signalHandler);\n\n        // \u521d\u59cb\u5316\u8def\u7531\u8868\n        initializeRoutes();\n        asio::io_context io_context;\n        //\u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u540c\u6b65\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u542f\u52a8io_context\u7684\u5de5\u4f5c\u7ebf\u7a0b\n        // // \u542f\u52a8io_context\u7684\u5de5\u4f5c\u7ebf\u7a0b\n        // boost::thread io_thread([&io_context]() {\n        //     io_context.run();\n        // });\n        \n        // \u7ebf\u7a0b\u6c60\u5927\u5c0f\u53ef\u4ee5\u6839\u636eCPU\u6838\u5fc3\u6570\u6216\u9700\u6c42\u8c03\u6574\n        unsigned int thread_pool_size = std::thread::hardware_concurrency();\n        if (thread_pool_size == 0)\n            thread_pool_size = 4; // \u9ed8\u8ba4\u503c\n        run_server(io_context, 8080, thread_pool_size);\n\n        // \u5173\u95edio_context\n        // io_context.stop();\n        // if (io_thread.joinable()) {\n        //     io_thread.join();\n        // }\n\n    }\n    catch (std::exception& e) {\n        std::cerr << 'Server error: ' << e.what() << '\\n';\n    }\n    return 0;\n}```\u3002", "top": 0, "createdAt": 1763604746, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-20", "dateLabelColor": "#0969da"}, "P9": {"htmlDir": "docs/post/Async-HttpServer -yi-bu-http-fu-wu.html", "labels": ["documentation", "Boost"], "postTitle": "Async-HttpServer \u5f02\u6b65http\u670d\u52a1", "postUrl": "post/Async-HttpServer%20-yi-bu-http-fu-wu.html", "postSourceUrl": "https://github.com/captain0005/captain/issues/9", "commentNum": 0, "wordCount": 7647, "description": "```\n#include <boost/asio.hpp>\n#include <boost/beast.hpp>\n#include <boost/json.hpp>\n#include <iostream>\n#include <functional>\n#include <map>\n#include <string>\n#include <thread>\n#include <boost/thread.hpp>\n#include <csignal>\n#include <vector>\n#include <memory>\n\nnamespace asio = boost::asio;\nnamespace beast = boost::beast;\nnamespace http = beast::http;\nnamespace json = boost::json;\nusing tcp = asio::ip::tcp;\n\n// \u5168\u5c40\u6807\u5fd7\uff0c\u7528\u4e8e\u63a7\u5236\u670d\u52a1\u5668\u9000\u51fa\nvolatile std::sig_atomic_t g_running = true;\n\n// \u4fe1\u53f7\u5904\u7406\u51fd\u6570\nvoid signalHandler(int signal) {\n    std::cout << 'Received signal ' << signal << ', shutting down...' << std::endl;\n    g_running = false;\n}\n\n// \u5b9a\u4e49\u5904\u7406\u5668\u51fd\u6570\u7c7b\u578b\ntypedef std::function<void(const http::request<http::string_body>&, http::response<http::string_body>&)> RequestHandler;\n\n// \u8def\u7531\u7ba1\u7406\u5668\u7c7b\uff0c\u7528\u4e8e\u6ce8\u518c\u548c\u67e5\u627e\u8def\u7531\nclass Router {\nprivate:\n    std::map<std::string, RequestHandler> routes;\n    std::string getRouteKey(http::verb method, const std::string& target) {\n        return std::to_string(static_cast<int>(method)) + ':' + target;\n    }\npublic:\n    void registerRoute(http::verb method, const std::string& target, RequestHandler handler) {\n        std::string key = getRouteKey(method, target);\n        routes[key] = handler;\n    }\n    bool handleRequest(const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        std::string key = getRouteKey(req.method(), std::string(req.target()));\n        auto it = routes.find(key);\n        if (it != routes.end()) {\n            it->second(req, res);\n            return true;\n        }\n        return false;\n    }\n};\n\n// \u5168\u5c40\u8def\u7531\u7ba1\u7406\u5668\u5b9e\u4f8b\nRouter g_router;\n\n// \u521d\u59cb\u5316\u8def\u7531\u8868\nvoid initializeRoutes() {\n    g_router.registerRoute(http::verb::get, '/status', [](const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        json::object response_json;\n        response_json['status'] = 'Server is running!';\n        res.result(http::status::ok);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    });\n\n    g_router.registerRoute(http::verb::post, '/greet', [](const http::request<http::string_body>& req, http::response<http::string_body>& res) {\n        json::object response_json;\n        try {\n            json::value parsed_body = json::parse(req.body());\n            std::string name = parsed_body.as_object()['name'].as_string().c_str();\n            response_json['message'] = 'Hello, ' + name + '!';\n        } catch (...) {\n            response_json['error'] = 'Invalid JSON format.';\n        }\n        res.result(http::status::ok);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    });\n    // \u53ef\u4ee5\u6839\u636e\u9700\u8981\u7ee7\u7eed\u6dfb\u52a0\u66f4\u591a\u8def\u7531...\n}\n\n// \u5904\u7406\u8bf7\u6c42\u7684\u51fd\u6570\nvoid handle_request(\n    http::request<http::string_body> req,\n    http::response<http::string_body>& res\n) {\n    json::object response_json;\n    std::cout << 'Method: ' << req.method() << '...\\n';\n    std::cout << 'Target: ' << req.target() << '...\\n';\n    std::cout << 'Body: ' << req.body() << '...\\n\\n';\n    if (!g_router.handleRequest(req, res)) {\n        response_json['error'] = 'Unknown endpoint.';\n        res.result(http::status::not_found);\n        res.set(http::field::content_type, 'application/json');\n        res.body() = json::serialize(response_json);\n        res.prepare_payload();\n    }\n}\n\n// \u5f02\u6b65\u4f1a\u8bdd\u7c7b\nclass Session : public std::enable_shared_from_this<Session> {\npublic:\n    Session(tcp::socket socket)\n        : socket_(std::move(socket)) {}\n\n    void start() {\n        do_read();\n    }\n\nprivate:\n    tcp::socket socket_;\n    beast::flat_buffer buffer_;\n    http::request<http::string_body> req_;\n\n    void do_read() {\n        auto self = shared_from_this();\n        http::async_read(socket_, buffer_, req_,\n            [self](beast::error_code ec, std::size_t) {\n                if (!ec) {\n                    self->handle_request();\n                }\n                // \u8fde\u63a5\u5173\u95ed\u7531\u5ba2\u6237\u7aef\u63a7\u5236\uff0c\u6216\u53ef\u5728\u6b64\u5904\u5173\u95ed\n            });\n    }\n\n    void handle_request() {\n        http::response<http::string_body> res;\n        ::handle_request(req_, res);\n\n        auto self = shared_from_this();\n        http::async_write(socket_, res,\n            [self](beast::error_code ec, std::size_t) {\n                beast::error_code ignore_ec;\n                self->socket_.shutdown(tcp::socket::shutdown_send, ignore_ec);\n                // \u4f1a\u8bdd\u5bf9\u8c61\u81ea\u52a8\u6790\u6784\n            });\n    }\n};\n\n// \u5f02\u6b65accept\nvoid do_accept(asio::io_context& ioc, tcp::acceptor& acceptor) {\n    acceptor.async_accept(\n        [&ioc, &acceptor](beast::error_code ec, tcp::socket socket) {\n            if (!ec) {\n                std::make_shared<Session>(std::move(socket))->start();\n            }\n            if (g_running) {\n                do_accept(ioc, acceptor);\n            }\n        }\n    );\n}\n\n// \u5f02\u6b65\u670d\u52a1\u5668\u4e3b\u51fd\u6570\nvoid run_server(asio::io_context& ioc, unsigned short port, unsigned int thread_pool_size) {\n    tcp::acceptor acceptor(ioc, tcp::endpoint(tcp::v4(), port));\n    do_accept(ioc, acceptor);\n\n    std::cout << 'HTTP Server running on port ' << port << '...\\n\\n';\n    std::vector<std::thread> threads;\n    for (unsigned int i = 0; i < thread_pool_size; ++i) {\n        threads.emplace_back([&ioc]() { ioc.run(); });\n    }\n    for (auto& t : threads) t.join();\n    std::cout << 'Server shutdown complete\\n';\n}\n\nint main() {\n    try {\n        std::signal(SIGINT, signalHandler);\n        std::signal(SIGTERM, signalHandler);\n\n        initializeRoutes();\n        asio::io_context io_context;\n\n        unsigned int thread_pool_size = std::thread::hardware_concurrency();\n        if (thread_pool_size == 0)\n            thread_pool_size = 4;\n        run_server(io_context, 8080, thread_pool_size);\n    }\n    catch (std::exception& e) {\n        std::cerr << 'Server error: ' << e.what() << '\\n';\n    }\n    return 0;\n}\n```\n###run_server\u51fd\u6570\u662f\u5f02\u6b65HTTP\u670d\u52a1\u5668\u7684\u6838\u5fc3\u542f\u52a8\u4e0e\u7ba1\u7406\u51fd\u6570\uff0c\u4e3b\u8981\u529f\u80fd\u5982\u4e0b\uff1a\n\n**\u670d\u52a1\u5668\u521d\u59cb\u5316\u4e0e\u542f\u52a8\uff1a**\n\n\u521b\u5efaTCP acceptor\u5e76\u7ed1\u5b9a\u5230\u6307\u5b9a\u7684IPv4\u7aef\u53e3\n\u8c03\u7528do_accept\u51fd\u6570\u542f\u52a8\u5f02\u6b65\u8fde\u63a5\u63a5\u53d7\u5faa\u73af\uff0c\u4f7f\u670d\u52a1\u5668\u80fd\u591f\u975e\u963b\u585e\u5730\u63a5\u53d7\u65b0\u8fde\u63a5\n\u8f93\u51fa\u670d\u52a1\u5668\u542f\u52a8\u4fe1\u606f\uff0c\u6307\u793a\u670d\u52a1\u5668\u6b63\u5728\u54ea\u4e2a\u7aef\u53e3\u8fd0\u884c\n**\u7ebf\u7a0b\u6c60\u521b\u5efa\u4e0e\u7ba1\u7406\uff1a**\n\n\u521b\u5efastd::vector<std::thread>\u5bb9\u5668\u6765\u7ba1\u7406\u5de5\u4f5c\u7ebf\u7a0b\u6c60\n\u6839\u636ethread_pool_size\u53c2\u6570\uff0c\u521b\u5efa\u6307\u5b9a\u6570\u91cf\u7684\u5de5\u4f5c\u7ebf\u7a0b\n\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u8fd0\u884cio_context.run()\uff0c\u542f\u52a8I/O\u4e8b\u4ef6\u5faa\u73af\n\u9009\u4e2d\u7684\u4ee3\u7801\u884cthreads.emplace_back([&ioc]() { ioc.run(); });\u521b\u5efa\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u5e76\u6355\u83b7io_context\u5f15\u7528\uff0c\u4f7f\u8be5\u7ebf\u7a0b\u5f00\u59cb\u5904\u7406\u5f02\u6b65\u64cd\u4f5c\u961f\u5217\n**\u670d\u52a1\u5668\u751f\u547d\u5468\u671f\u7ba1\u7406\uff1a**\n\n\u4f7f\u7528join()\u7b49\u5f85\u6240\u6709\u5de5\u4f5c\u7ebf\u7a0b\u5b8c\u6210\uff0c\u786e\u4fdd\u670d\u52a1\u5668\u4f18\u96c5\u5173\u95ed\n\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2aio_context\u5b9e\u4f8b\uff0c\u534f\u540c\u5904\u7406\u5f02\u6b65\u4e8b\u4ef6\n\u5f53io_context\u505c\u6b62\u65f6\uff08\u901a\u5e38\u7531\u4fe1\u53f7\u5904\u7406\u5668\u8bbe\u7f6eg_running=false\u89e6\u53d1\uff09\uff0c\u6240\u6709\u7ebf\u7a0b\u4f1a\u9000\u51fa\u5176\u4e8b\u4ef6\u5faa\u73af\n\u8f93\u51fa\u670d\u52a1\u5668\u5173\u95ed\u5b8c\u6210\u7684\u4fe1\u606f\n**\u5de5\u4f5c\u539f\u7406\uff1a**\n\n\u8fd9\u79cd\u8bbe\u8ba1\u91c7\u7528\u4e86Boost.Asio\u7684'\u7ebf\u7a0b\u6c60 + \u5355io_context'\u6a21\u5f0f\uff0c\u63d0\u9ad8\u4e86\u670d\u52a1\u5668\u5904\u7406\u5e76\u53d1\u8bf7\u6c42\u7684\u80fd\u529b\n\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u521d\u59cb\u5316\u548c\u7b49\u5f85\uff0c\u800c\u5de5\u4f5c\u7ebf\u7a0b\u5904\u7406\u5b9e\u9645\u7684\u7f51\u7edcI/O\u4e8b\u4ef6\n\u5f02\u6b65\u63a5\u53d7\u8fde\u63a5\u548c\u5f02\u6b65\u5904\u7406\u8bf7\u6c42\u76f8\u7ed3\u5408\uff0c\u5b9e\u73b0\u4e86\u9ad8\u6027\u80fd\u7684\u975e\u963b\u585e\u670d\u52a1\u5668\u67b6\u6784\n\u8be5\u51fd\u6570\u662f\u6574\u4e2a\u5f02\u6b65HTTP\u670d\u52a1\u5668\u7684\u9aa8\u67b6\uff0c\u901a\u8fc7\u7ebf\u7a0b\u6c60\u673a\u5236\u5145\u5206\u5229\u7528\u591a\u6838CPU\u8d44\u6e90\uff0c\u540c\u65f6\u4fdd\u6301\u5f02\u6b65\u975e\u963b\u585e\u7684\u9ad8\u6548\u7279\u6027\u3002", "top": 0, "createdAt": 1763624746, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-11-20", "dateLabelColor": "#0969da"}}, "singeListJson": {}, "labelColorDict": {"Boost": "#53171e", "bug": "#d73a4a", "documentation": "#0075ca", "duplicate": "#cfd3d7", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "question": "#d876e3", "wontfix": "#ffffff"}, "displayTitle": "Blog Title", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://captain0005.github.io/captain", "prevUrl": "disabled", "nextUrl": "disabled"}